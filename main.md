# 自然な木の3D画像を生成するためのプログラム

或る程度自然な木を3Dで描画します  
これは、木を成長させながら描画することで成長のアニメーションのようなものも作成できるよう意図されています  

## 大まかな方針
木は木構造のデータで表現します  

或る程度の大きさの木を想定するため、一つ一つの葉の詳細は保持せず、葉は単にグラフの葉と同様として扱います  
これは葉の追加によって既存の葉が枝に変わるようなことを許容します  


描画プログラムの基本的な流れは以下の流れです
1. 木を誕生させる
2. 木を任意ステップ成長させる
3. 木を描画する

アニメーションを行う際には適切に変更する必要があります  

アニメーションを行い場合、或いはインタラクティブな成長を行う場合の流れは以下の通りです  

初期化
1. 木を誕生させる
2. 木を描画する

成長
1. 木を任意ステップ成長させる
2. 木を描画する

## 木のデータ構造

木の構造を保持する部分と、木の形質を左右するパラメータが存在します  
木の構造やパラメータは木の成長により変化します  

### 木の構造

木の付け根(基点,Base Node)が存在します  
木のデータ構造は、基点を根とする有向木として表現します
(即ち、有向非巡回で閉路がない)  
木は節と葉を子に持ち、基点から節点及び節点から節点を結ぶ辺を枝幹と呼び、節点から葉を結ぶ辺を葉脈と呼びます  
節点及び葉は、親を基準とした相対的な向き捻じれ及び長さを位置情報として保持し、親との間に形成する枝幹や葉脈の相対的な太さを保持します  

### 木の形質

一般に、子の枝幹の太さは親の太さよりも小さい必要があります  
太さは相対的に指定されるので、0倍より大きく1より小さいことが必要です  

基点はただ一つの基幹か葉を持ちます  
即ち、基幹の分岐は基点以外から行われます  

- 枝幹の分かれやすさ
- 枝幹の向き
- 枝幹の最大長さ
- 枝幹の最大太さ

- 葉の最大長さ
- 葉の太さ

- 枝幹の色
- 葉の色

## 木のモデルの構築

木のデータは成長を模倣して作成します  

先ず木が誕生し、それを成長させます  

### 木の誕生

基点を生成します  
形質を生成します  

### 木の成長

成長の内容を1つ定める関数を定義します  
この関数では、モデルの現在の状態を考慮しながら確率的にパラメータを決定する多数の関数を使用します  

成長の内容は以下の通りです
- 新たな葉の発生
  - 枝葉は徐々に増加します
  - 既存の節点や葉を選び、新たな葉を生成します
- 長さ及び太さの変更
  - 枝幹は徐々に太くなります
  - 既存の節点や葉を選び、長さや太さを変更します
- 枝の消滅
  - 古くなったり過密になった枝は消滅します
  - 既存の節点や葉を選び、削除します
- 向きの変更
  - 障害物等の妨害を受けて向きを変えることがあります
  - 既存の節点や葉を選び、向きを変更します

木の成長の1ステップとして次を定めます
- 成長の内容を1つ定めます
- 成長を適用します

#### 成長の戦略

自然な木のモデルを形成するための戦略を提示します  

葉の発生は、先端に近い、即ち基点から遠いものが優先的に選択されるのが望ましいと考えられます  
葉の発生において、ある程度の長さをもっている必要があります  
太さの変更は、基点に近いものが優先的に選択されるのが望ましいと考えられます  
向きの変更は、重力や風や障害物の影響が考えられます  
枝葉は親に対してある程度の角度をもって分岐します  
分岐の角度は、基点から近いものほど大きいのが望ましいです  

植物学におけるキーワード
- 頂芽優勢
- 葉序

自然な木を生成するためには、適切な戦略を慎重に採用する必要があります  

## 木の描画

木のモデルに従って木を描画します  

モデルは木構造で相対的な指定を持つので再帰的に処理するのが自然かつ望ましいです  

枝幹は円柱として描画します  

葉脈については特別に扱い、各葉が保持する太さは無視して、木の形質としてパラメータにある葉の太さを用いて描画します  
枝と同様に扱うため葉脈としていますが、葉の本体の平面も描画する必要があります  
葉及び葉脈は楕円形の平面として描画します  

円柱や葉が適切に描画されるよう、座標の仕様には十分に注意する必要があります  
円柱や葉の座標がズレるとバラバラの木が描画されてしまいます  
特にローカル座標とグローバル座標の違いは重要です  